# Google Docs System Design
## 1. Тема и целевая аудитория
Google Документы – это текстовый редактор, позволяющий создавать и форматировать документы, а также работать над ними совместно с другими пользователями. 

### MVP
- Создать документ
- Изменять документ в реальном времени
- Работа с историей изменений
  - Просмотреть историю
  - Откатиться к прошлой версии
- Работа с ACL
  - Изменить права на просмотр/редактирование
  - Добавить/аннулировать ссылку на просмотр
- Клонировать документ

## Целевая аудитория
Уникальных пользователей в месяц: [500 млн](https://pro.similarweb.com/#/sales/account-review/traffic-engagement/docs.google.com/*/999/1m/?webSource=Total&selectedWidgetTab=UniqueUsers)

[Распределение по странам](https://pro.similarweb.com/#/sales/account-overview/docs.google.com/company)
- США: 27%
- Индия: 7,7%
- Индонезия: 6,5%
- Бразилия: 5,7%
- Япония: 3,3%

## 2. Расчет нагрузки
Google не предоставляет статистики по использованию сервиса Google Docs. Однако, есть [официальная квота на использование API](https://developers.google.com/docs/api/limits):
- Чтение
  - 3000 запросов на документ в минуту (всего)
  - 300 запросов на документ в минуту (от каждого пользователя)
- Запись
  - 600 запросов на документ в минуту (всего)
  - 60 запросов на документ в минуту (от каждого пользователя)

Исходя из официальной квоты:
- Документ читают в 5 раз чаще, чем редактируют
- Документ читают одновременно 10 пользователей
- Документ редактируют одновременно 10 пользователей

Данных по использованию по времени Google не публикует, поэтому возьмем цифры с потолка:
- На просмотр документов пользователи тратят в среднем 60 минут в месяц  
  $\texttt{READING\_MINUTES\_PER\_USER} = 60$
- На редактирование документа пользователи тратят в среднем 180 минут в месяц  
  $\texttt{EDITING\_MINUTES\_PER\_USER} = 180$

Тогда
- Читающих пользователей: 500 млн в месяц (MAU) 
  $\texttt{READING\_USERS} = 500 \cdot 10^6$
- Редактирующих пользователей: $500 \over 5$ = 100 млн в месяц
  $\texttt{EDITING\_USERS} = 100 \cdot 10^6$

В одном месяце $60 \cdot 24 \cdot 30$ = 49680 $\sim$ 50000 минут  
$\texttt{MINUTES\_IN\_MONTH} = 50 \cdot 10^3$

В минуту читают одновременно: ${\texttt{READING\_MINUTES\_PER\_USER} \cdot\ \texttt{READING\_USERS} \over \texttt{MINUTES\_IN\_MONTH}} = {60 \cdot 500 \cdot 10^6 \over 50 \cdot 10^3} = 600 \cdot 10^3$

В минуту редактируют одновременно: ${\texttt{EDITING\_MINUTES\_PER\_USER} \cdot\ \texttt{EDITING\_USERS} \over \texttt{MINUTES\_IN\_MONTH}} = {180 \cdot 100 \cdot 10^6 \over 50 \cdot 10^3} = 360 \cdot 10^3$  
$\texttt{EDITS\_PER\_MINUTE} = 360 \cdot 10^3$

Предположим, что в минуту происходит 100 изменений. Изменение - это добавление/удаление/замена 1 символа в документе.  
$\texttt{EDITS\_PER\_MINUTE\_PER\_USER} = 100$

Тогда кол-во запросов на изменение в минуту:  
 $\texttt{EDITS\_PER\_MINUTE} \cdot \texttt{EDITS\_PER\_MINUTE\_PER\_USER} = 36 * 10^6$
